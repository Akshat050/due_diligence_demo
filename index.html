<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Due Diligence System Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .main-content {
            padding: 30px;
        }

        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .input-group {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .input-group input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .analyze-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .workflow-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .step {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 2px solid #f1f3f5;
            transition: all 0.3s ease;
        }

        .step:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .step.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea10 0%, #764ba210 100%);
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        .step-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .step-content {
            color: #6c757d;
            line-height: 1.6;
        }

        .step-data {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
            border-left: 4px solid #667eea;
        }

        .final-report {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.3);
        }

        .final-report h3 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .report-icon {
            font-size: 2rem;
            margin-right: 15px;
        }

        .risk-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.2);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Due Diligence System Demo</h1>
            <p>Input ‚Üí API ‚Üí Audit ‚Üí Embeddings ‚Üí Report</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <div class="input-group">
                    <input type="text" id="companyInput" placeholder="Enter company name (e.g., Tesla, Apple, Microsoft)" value="Tesla">
                    <button class="analyze-btn" id="analyzeBtn" onclick="runAnalysis()">
                        <span id="btnText">Analyze</span>
                        <span id="btnLoading" class="loading hidden"></span>
                    </button>
                </div>
            </div>

            <div class="workflow-steps">
                <div class="step" id="step1">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <div class="step-title">Fetch Company Data</div>
                    </div>
                    <div class="step-content">
                        Retrieving company information from external APIs (mocked for demo)
                        <div class="step-data hidden" id="step1-data"></div>
                    </div>
                </div>

                <div class="step" id="step2">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        <div class="step-title">Audit Trail Logging</div>
                    </div>
                    <div class="step-content">
                        Recording query timestamp, raw data, and metadata for compliance
                        <div class="step-data hidden" id="step2-data"></div>
                    </div>
                </div>

                <div class="step" id="step3">
                    <div class="step-header">
                        <div class="step-number">3</div>
                        <div class="step-title">Generate Embeddings</div>
                    </div>
                    <div class="step-content">
                        Converting company data into vector embeddings for analysis
                        <div class="step-data hidden" id="step3-data"></div>
                    </div>
                </div>

                <div class="step" id="step4">
                    <div class="step-header">
                        <div class="step-number">4</div>
                        <div class="step-title">Due Diligence Report</div>
                    </div>
                    <div class="step-content">
                        Generating comprehensive risk assessment and recommendations
                        <div class="step-data hidden" id="step4-data"></div>
                    </div>
                </div>
            </div>

            <div class="final-report hidden" id="finalReport">
                <h3><span class="report-icon">üìä</span>Due Diligence Summary</h3>
                <div id="reportContent"></div>
            </div>
        </div>
    </div>

    <script>
        // Mock company database
        const mockCompanyData = {
            tesla: {
                name: "Tesla, Inc.",
                ticker: "TSLA",
                sector: "Automotive/Technology",
                marketCap: "$800B",
                revenue: "$96.8B",
                employees: 140000,
                founded: 2003,
                ceo: "Elon Musk",
                headquarters: "Austin, Texas",
                riskFactors: ["Regulatory scrutiny in Europe", "Supply chain dependencies", "Market volatility"],
                strengths: ["Innovation leadership", "Strong brand", "Growing market share"],
                financialHealth: "Stable",
                esgScore: 7.2,
                complianceIssues: ["European regulatory inquiries", "SEC investigations"]
            },
            apple: {
                name: "Apple Inc.",
                ticker: "AAPL",
                sector: "Technology",
                marketCap: "$3.0T",
                revenue: "$394.3B",
                employees: 164000,
                founded: 1976,
                ceo: "Tim Cook",
                headquarters: "Cupertino, California",
                riskFactors: ["China market dependency", "Supply chain risks", "Antitrust scrutiny"],
                strengths: ["Strong ecosystem", "Premium pricing power", "Cash reserves"],
                financialHealth: "Excellent",
                esgScore: 8.1,
                complianceIssues: ["EU Digital Markets Act compliance"]
            },
            microsoft: {
                name: "Microsoft Corporation",
                ticker: "MSFT",
                sector: "Technology",
                marketCap: "$2.8T",
                revenue: "$211.9B",
                employees: 228000,
                founded: 1975,
                ceo: "Satya Nadella",
                headquarters: "Redmond, Washington",
                riskFactors: ["Cloud competition", "Cybersecurity threats", "Regulatory changes"],
                strengths: ["Cloud dominance", "Diverse portfolio", "Strong enterprise relationships"],
                financialHealth: "Excellent",
                esgScore: 8.5,
                complianceIssues: ["Minor data privacy inquiries"]
            }
        };

        async function runAnalysis() {
            const companyName = document.getElementById('companyInput').value.trim();
            if (!companyName) {
                alert('Please enter a company name');
                return;
            }

            // Reset UI
            resetUI();
            setLoadingState(true);

            try {
                // Step 1: Fetch Company Data
                await simulateStep(1, async () => {
                    const companyData = await fetchCompanyData(companyName);
                    document.getElementById('step1-data').innerHTML = JSON.stringify(companyData, null, 2);
                    return companyData;
                });

                // Step 2: Audit Trail
                const auditData = await simulateStep(2, async () => {
                    const audit = await logAuditTrail(companyName);
                    document.getElementById('step2-data').innerHTML = JSON.stringify(audit, null, 2);
                    return audit;
                });

                // Step 3: Generate Embeddings
                const embeddings = await simulateStep(3, async () => {
                    const embeds = await generateEmbeddings(companyName);
                    document.getElementById('step3-data').innerHTML = 
                        `Vector dimensions: ${embeds.dimensions}\nSample values: [${embeds.sample.join(', ')}...]`;
                    return embeds;
                });

                // Step 4: Generate Report
                const report = await simulateStep(4, async () => {
                    const reportData = await generateDueDiligenceReport(companyName);
                    document.getElementById('step4-data').innerHTML = reportData.summary;
                    return reportData;
                });

                // Show final report
                showFinalReport(report);

            } catch (error) {
                console.error('Analysis failed:', error);
                alert('Analysis failed. Please try again.');
            } finally {
                setLoadingState(false);
            }
        }

        async function simulateStep(stepNumber, stepFunction) {
            // Activate step
            document.getElementById(`step${stepNumber}`).classList.add('active');
            
            // Simulate processing time
            await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1000));
            
            // Execute step function
            const result = await stepFunction();
            
            // Show step data
            document.getElementById(`step${stepNumber}-data`).classList.remove('hidden');
            document.getElementById(`step${stepNumber}-data`).classList.add('fade-in');
            
            return result;
        }

        async function fetchCompanyData(companyName) {
            const key = companyName.toLowerCase();
            const data = mockCompanyData[key];
            
            if (!data) {
                // Generate generic data for unknown companies
                return {
                    name: companyName,
                    ticker: "UNKNOWN",
                    sector: "Unknown",
                    marketCap: "N/A",
                    revenue: "N/A",
                    status: "Limited data available",
                    riskFactors: ["Insufficient public data"],
                    financialHealth: "Unknown"
                };
            }
            
            return data;
        }

        async function logAuditTrail(companyName) {
            return {
                timestamp: new Date().toISOString(),
                query: companyName,
                user: "demo_user",
                source: "mock_api",
                dataHash: generateHash(companyName),
                compliance: {
                    gdprCompliant: true,
                    dataRetention: "90 days",
                    auditTrail: true
                }
            };
        }

        async function generateEmbeddings(companyName) {
            // Mock embedding generation
            const dimensions = 768;
            const embedding = Array.from({length: dimensions}, () => Math.random() * 2 - 1);
            
            return {
                dimensions: dimensions,
                sample: embedding.slice(0, 8).map(x => x.toFixed(4)),
                full: embedding,
                model: "mock-embeddings-v1"
            };
        }

        async function generateDueDiligenceReport(companyName) {
            const key = companyName.toLowerCase();
            const data = mockCompanyData[key];
            
            if (!data) {
                return {
                    riskScore: "High",
                    summary: "Insufficient data available for comprehensive analysis. Recommend additional research.",
                    recommendations: ["Gather more financial data", "Verify business registration", "Check regulatory status"],
                    confidence: "Low"
                };
            }
            
            // Calculate risk score based on various factors
            let riskScore = "Low";
            let riskColor = "#28a745";
            
            if (data.complianceIssues.length > 1 || data.esgScore < 6) {
                riskScore = "High";
                riskColor = "#dc3545";
            } else if (data.complianceIssues.length > 0 || data.esgScore < 8) {
                riskScore = "Medium";
                riskColor = "#ffc107";
            }
            
            const summary = `${data.name} shows ${data.financialHealth.toLowerCase()} financial health with ${data.complianceIssues.length > 0 ? 'ongoing regulatory matters' : 'minimal compliance issues'}. ESG score: ${data.esgScore}/10.`;
            
            return {
                riskScore,
                riskColor,
                summary,
                company: data.name,
                sector: data.sector,
                marketCap: data.marketCap,
                strengths: data.strengths,
                risks: data.riskFactors,
                recommendations: generateRecommendations(data),
                confidence: "High"
            };
        }

        function generateRecommendations(data) {
            const recommendations = [];
            
            if (data.complianceIssues.length > 0) {
                recommendations.push("Monitor regulatory developments closely");
            }
            
            if (data.esgScore < 8) {
                recommendations.push("Assess ESG improvement initiatives");
            }
            
            if (data.riskFactors.includes("Market volatility")) {
                recommendations.push("Consider hedging strategies");
            }
            
            recommendations.push("Conduct quarterly review");
            
            return recommendations;
        }

        function showFinalReport(report) {
            const reportDiv = document.getElementById('finalReport');
            const contentDiv = document.getElementById('reportContent');
            
            contentDiv.innerHTML = `
                <div class="risk-badge" style="background-color: ${report.riskColor}20; color: ${report.riskColor}; border: 1px solid ${report.riskColor};">
                    Risk Score: ${report.riskScore}
                </div>
                <p style="font-size: 1.2rem; margin-bottom: 20px;">${report.summary}</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div>
                        <h4 style="margin-bottom: 10px;">üìà Key Strengths</h4>
                        <ul style="margin-left: 20px;">
                            ${report.strengths ? report.strengths.map(s => `<li>${s}</li>`).join('') : '<li>Data not available</li>'}
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="margin-bottom: 10px;">‚ö†Ô∏è Risk Factors</h4>
                        <ul style="margin-left: 20px;">
                            ${report.risks ? report.risks.map(r => `<li>${r}</li>`).join('') : '<li>Minimal identified risks</li>'}
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="margin-bottom: 10px;">üí° Recommendations</h4>
                        <ul style="margin-left: 20px;">
                            ${report.recommendations.map(r => `<li>${r}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
            
            reportDiv.classList.remove('hidden');
            reportDiv.classList.add('fade-in');
        }

        function resetUI() {
            // Hide final report
            document.getElementById('finalReport').classList.add('hidden');
            
            // Reset all steps
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`step${i}`).classList.remove('active');
                document.getElementById(`step${i}-data`).classList.add('hidden');
            }
        }

        function setLoadingState(loading) {
            const btn = document.getElementById('analyzeBtn');
            const btnText = document.getElementById('btnText');
            const btnLoading = document.getElementById('btnLoading');
            
            btn.disabled = loading;
            
            if (loading) {
                btnText.classList.add('hidden');
                btnLoading.classList.remove('hidden');
            } else {
                btnText.classList.remove('hidden');
                btnLoading.classList.add('hidden');
            }
        }

        function generateHash(input) {
            let hash = 0;
            for (let i = 0; i < input.length; i++) {
                const char = input.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString(16).substring(0, 8);
        }

        // Allow Enter key to trigger analysis
        document.getElementById('companyInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                runAnalysis();
            }
        });
    </script>
</body>
</html>
